<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Davamiyy…ôt C…ôdv…ôli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #111827; /* bg-gray-900 */
        }
        
        /* üé® Custom CSS from your design guide */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }
        ::selection { background-color: #3b82f6; color: white; }

        /* For the sticky column to work */
        .sticky-col {
            position: -webkit-sticky; /* For Safari */
            position: sticky;
            left: 0;
            z-index: 10;
        }
        
        /* Ensure sticky header cell has the right background */
        thead .sticky-col {
            background-color: #1f2937; /* bg-gray-800 */
        }
        
        /* Ensure sticky body cells have the right background on hover too */
        tbody tr .sticky-col {
             background-color: #1f2937; /* bg-gray-800 */
        }
        tbody tr:hover .sticky-col {
             background-color: #374151; /* bg-gray-700 */
        }

    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 pb-2">
                Davamiyy…ôt C…ôdv…ôli
            </h1>
            <p class="text-lg text-gray-400 mt-2">≈ûagirdl…ôrin f…ônl…ôr √ºzr…ô √ºmumi qayƒ±blarƒ±</p>
        </header>

        <main class="bg-gray-800 rounded-xl shadow-2xl border border-gray-700 overflow-hidden">
            <div id="attendance-table-container" class="overflow-x-auto">
                <p id="loading-message" class="p-8 text-gray-400 text-center text-lg">M…ôlumatlar y√ºkl…ônir...</p>
            </div>
        </main>
    </div>

    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl w-full max-w-sm max-h-[90vh] flex flex-col transform transition-all">
            <div class="flex justify-between items-center p-5 border-b border-gray-700">
                <h2 id="modal-title" class="text-xl font-semibold text-gray-200">Qayƒ±b Tarixl…ôri</h2>
                <button id="close-modal" class="text-gray-500 hover:text-white text-3xl transition-colors">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <ul id="modal-list-body" class="space-y-3">
                    </ul>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // FIREBASE M∆èLUMATLARI
        const firebaseConfig = {
            apiKey: "AIzaSyAtQ_laoPhn_31RgUFp5hkHPzAcYJSH9_8",
            authDomain: "davamiyyet-sistemi.firebaseapp.com",
            projectId: "davamiyyet-sistemi",
            storageBucket: "davamiyyet-sistemi.appspot.com",
            messagingSenderId: "773549402059",
            appId: "1:773549402059:web:25286906aa1d998041f84e",
            measurementId: "G-M3Y8QZCM8C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const tableContainer = document.getElementById('attendance-table-container');
        const loadingMessage = document.getElementById('loading-message');
        const modal = document.getElementById('details-modal');
        const closeModalButton = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalListBody = document.getElementById('modal-list-body');
        
        let allAbsences = [];

        const students = [
          "ƒ∞sayev Ramal R…ôfayƒ±l",
          "Qulamov Kamil Amil",
          "Abbaszad…ô Salman M…ôsud",
          "Heyd…ôrli Heyd…ôr Sabir",
          "Mikayƒ±lova Lal…ô Samir",
          "Seyidov Nur…ôli Mirnayƒ±b",
          "K√ºb…ôrov Rahid Mahmud",
          "Bayramov M…ômm…ôd Vaqif",
          "H…ôs…ônov M…ônz…ôr ƒ∞lqar",
          "R√ºst…ômov Elg√ºn Ceyhun",
          "Xasayeva N…ôrmin Az…ôr",
          "ƒ∞balƒ± C…ômil…ô R…ôfail",
          "Mirz…ôyeva N√º≈üab…ô Hacƒ±…ôli",
          "Muradova Leyla Qadir",
          "∆èhm…ôdov K…ônan Ceyhun",
          "Sultanlƒ± Nihad S…ôrhad",
          "∆èsg…ôrov Elnar V√ºsal",
          "H√ºseynli N…ôrgiz M√ºt…ôllim",
          "Miri≈üov Nihad Murad",
          "Aƒüalizad…ô S…ôid Elman",
          "H√ºseynova Firuz…ô S…ônan",
          "Aƒüak…ôrimov F…ôqan Alim",
          "H…ôs…ônova C…ômal…ô Sergey",
          "∆èliyev Fuad Razim",
          "Orucov Nurlan Seymur",
          "M…ôh…ôrr…ômli Nicat Elxan"
        ];

        const subjects = ["Ehtimal n…ôz…ôriyy…ôsi v…ô statistika", "Sistem proqramla≈üdƒ±rma", "XDIAK-3", "Veril…ônl…ôr bazasƒ± sisteml…ôri", "Komp√ºter arxitekturasƒ±-1", "Web sisteml…ôri v…ô texnologiyalarƒ±"];

        const q = query(collection(db, "qayiblar"), orderBy("tarix", "desc"));
        onSnapshot(q, (querySnapshot) => {
            allAbsences = querySnapshot.docs.map(doc => doc.data());
            updateUI();
        });

        function updateUI() {
            const absencesByStudent = {};
            students.forEach(student => {
                absencesByStudent[student] = {};
                subjects.forEach(subject => {
                    absencesByStudent[student][subject] = 0;
                });
            });

            allAbsences.forEach(absence => {
                if (absencesByStudent[absence.usaqAdi] && absencesByStudent[absence.usaqAdi][absence.fenn] !== undefined) {
                    absencesByStudent[absence.usaqAdi][absence.fenn]++;
                }
            });

            let tableHTML = `
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-400 uppercase bg-gray-800">
                        <tr>
                            <th scope="col" class="sticky-col py-4 px-6 font-semibold">Ad Soyad</th>`;
            subjects.forEach(subject => {
                tableHTML += `<th scope="col" class="py-4 px-6 text-center font-semibold">${subject}</th>`;
            });
            tableHTML += `</tr></thead><tbody>`;

            students.forEach(student => {
                tableHTML += `<tr class="border-b border-gray-700 hover:bg-gray-700 transition-colors duration-200">
                                <td class="sticky-col py-4 px-6 font-medium text-gray-200 whitespace-nowrap">${student}</td>`;
                subjects.forEach(subject => {
                    const count = absencesByStudent[student][subject];
                    const countColor = count > 0 ? 'text-yellow-400' : 'text-gray-500';
                    const isClickable = count > 0 ? 'cursor-pointer' : '';

                    tableHTML += `<td 
                                    class="py-4 px-6 text-center font-bold text-lg ${countColor} ${isClickable}"
                                    data-student="${student}" 
                                    data-subject="${subject}">
                                    ${count}
                                  </td>`;
                });
                tableHTML += `</tr>`;
            });

            tableHTML += `</tbody></table>`;
            tableContainer.innerHTML = tableHTML;
            loadingMessage.style.display = 'none';

            tableContainer.querySelectorAll('td[data-student]').forEach(cell => {
                if (parseInt(cell.textContent) > 0) {
                    cell.addEventListener('click', () => {
                        const studentName = cell.getAttribute('data-student');
                        const subjectName = cell.getAttribute('data-subject');
                        showDetails(studentName, subjectName);
                    });
                }
            });
        }
        
        function showDetails(student, subject) {
            modalTitle.textContent = `${student} - ${subject}`;
            modalListBody.innerHTML = '';

            const filteredAbsences = allAbsences
                .filter(a => a.usaqAdi === student && a.fenn === subject)
                .sort((a, b) => new Date(a.tarix) - new Date(b.tarix));
            
            if (filteredAbsences.length === 0) {
                modalListBody.innerHTML = '<li class="p-3 text-center text-gray-400">Qayƒ±b tapƒ±lmadƒ±.</li>';
            } else {
                filteredAbsences.forEach(absence => {
                    const listItem = document.createElement('li');
                    listItem.className = 'bg-gray-700 p-3 rounded-lg text-center font-mono text-blue-300';
                    listItem.textContent = absence.tarix;
                    modalListBody.appendChild(listItem);
                });
            }
            modal.classList.remove('hidden');
        }

        closeModalButton.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.add('hidden');
        });
    </script>
</body>
</html>
